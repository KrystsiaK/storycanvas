# üé® DrawingCanvas - Modular Architecture

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ Skia Canvas, –≥–æ—Ç–æ–≤–∞—è –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
DrawingCanvas/
‚îú‚îÄ‚îÄ index.tsx                 # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ Canvas.tsx                # Canvas —Ä–µ–Ω–¥–µ—Ä —Å Skia
‚îú‚îÄ‚îÄ Header.tsx                # –•–µ–¥–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏
‚îú‚îÄ‚îÄ Toolbar/                  # –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx            # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç—É–ª–±–∞—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ ToolButton.tsx       # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –∫–Ω–æ–ø–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ ColorPicker.tsx      # –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ BrushSizePicker.tsx  # –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ –∫–∏—Å—Ç–∏
‚îú‚îÄ‚îÄ hooks/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ useDrawing.ts        # –õ–æ–≥–∏–∫–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ useHistory.ts        # Undo/Redo
‚îÇ   ‚îî‚îÄ‚îÄ useCanvasState.ts    # –°–æ—Å—Ç–æ—è–Ω–∏–µ canvas
‚îú‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ pathService.ts       # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—É—Ç—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ storageService.ts    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/—ç–∫—Å–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ utils/                    # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ constants.ts         # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îî‚îÄ‚îÄ types/                    # TypeScript —Ç–∏–ø—ã
    ‚îî‚îÄ‚îÄ index.ts             # –û–±—â–∏–µ —Ç–∏–ø—ã
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### index.tsx
–ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—É—Ç–µ–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç

### Canvas.tsx
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- –†–µ–Ω–¥–µ—Ä–∏—Ç Skia Canvas
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∏ —Ç–µ–∫—É—â–∏–µ –ø—É—Ç–∏
- –ü–µ—Ä–µ–¥–∞–µ—Ç touch —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ PanResponder
- –ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é (—Ñ–æ–Ω—ã, —Å–ª–æ–∏, —ç—Ñ—Ñ–µ–∫—Ç—ã)

### Header.tsx
–ü—Ä–æ—Å—Ç–æ–π —Ö–µ–¥–µ—Ä:
- –ö–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ó–∞–≥–æ–ª–æ–≤–æ–∫
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, –º–µ–Ω—é)

### Toolbar/
–ú–æ–¥—É–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:
- **index.tsx** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ª–æ–≥–∏–∫–æ–π
- **ToolButton.tsx** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –∫–Ω–æ–ø–∫–∞
- **ColorPicker.tsx** - –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
- **BrushSizePicker.tsx** - –≤—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞

## üé£ –•—É–∫–∏

### useDrawing
–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PanResponder
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π
- Callback –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—É—Ç–∏
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: –¥–æ–±–∞–≤–∏—Ç—å pressure sensitivity, multitouch

### useHistory
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π:
- Undo/Redo —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É
- –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### useCanvasState
–°–æ—Å—Ç–æ—è–Ω–∏–µ canvas:
- –¢–µ–∫—É—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä
- –ü—Ä–æ—Å—Ç–æ–π API –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: opacity, blend modes, filters

## üõ† –°–µ—Ä–≤–∏—Å—ã

### pathService
–û–ø–µ—Ä–∞—Ü–∏–∏ —Å Skia Path:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Ç–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: –∫—Ä–∏–≤—ã–µ –ë–µ–∑—å–µ, —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ, —Ñ–æ—Ä–º—ã

### storageService
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç:
- –≠–∫—Å–ø–æ—Ä—Ç –≤ base64
- –î–∏–∞–ª–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –æ–±–ª–∞–∫–æ, —Ñ–æ—Ä–º–∞—Ç—ã (SVG, PDF)

## üéØ –¢–∏–ø—ã

### PathData
```typescript
interface PathData {
  path: SkPath;
  color: string;
  strokeWidth: number;
  tool: ToolType;
  timestamp: number;
}
```

### ToolType
```typescript
type ToolType = "pen" | "eraser" | "brush" | "marker" | "highlighter";
```

## üöÄ –ö–∞–∫ —Ä–∞—Å—à–∏—Ä—è—Ç—å

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

1. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –≤ `types/index.ts`**:
```typescript
type ToolType = "pen" | "eraser" | "brush" | "marker" | "highlighter" | "spray";
```

2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `utils/constants.ts`**:
```typescript
{
  type: "spray",
  icon: "grain",
  label: "Spray",
  defaultStrokeWidth: 20,
}
```

3. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `services/pathService.ts`**:
```typescript
case "spray":
  return baseWidth * 2;
```

### –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–∏

1. **–°–æ–∑–¥–∞—Ç—å —Ö—É–∫ `hooks/useLayers.ts`**:
```typescript
export const useLayers = () => {
  const [layers, setLayers] = useState<Layer[]>([]);
  const [activeLayer, setActiveLayer] = useState(0);
  // ...
};
```

2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `LayerPanel.tsx`**
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `index.tsx`**

### –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã/—ç—Ñ—Ñ–µ–∫—Ç—ã

1. **–°–æ–∑–¥–∞—Ç—å `services/filterService.ts`**
2. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `types/`**
3. **–û–±–Ω–æ–≤–∏—Ç—å `Canvas.tsx` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤**

### –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

1. **–†–∞—Å—à–∏—Ä–∏—Ç—å `hooks/useHistory.ts`**:
```typescript
useEffect(() => {
  const timer = setInterval(() => {
    saveToStorage(paths);
  }, 30000); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
  
  return () => clearInterval(timer);
}, [paths]);
```

### –î–æ–±–∞–≤–∏—Ç—å –∂–µ—Å—Ç—ã (zoom, pan)

1. **–°–æ–∑–¥–∞—Ç—å `hooks/useCanvasTransform.ts`**
2. **–î–æ–±–∞–≤–∏—Ç—å Pinch/Pan gestures**
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∫ Canvas**

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞

–í `Canvas.tsx` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—É—Ä—Å–æ—Ä–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Web):
```typescript
cursor: "crosshair" as any
```

–î–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞-–∫–∏—Å—Ç–æ—á–∫–∏:
1. –°–æ–∑–¥–∞—Ç—å SVG –∏–∫–æ–Ω–∫—É –∫–∏—Å—Ç–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSS `cursor: url(brush.svg), auto`
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `style` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ Canvas

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```typescript
import { DrawingCanvas } from './components/DrawingCanvas';

<DrawingCanvas
  visible={showCanvas}
  onClose={() => setShowCanvas(false)}
  onSave={(imageData) => {
    console.log('Saved:', imageData);
  }}
/>
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```typescript
const canvasRef = useRef<DrawingCanvasRef>(null);

// –û—á–∏—Å—Ç–∏—Ç—å canvas
canvasRef.current?.clear();

// Undo
canvasRef.current?.undo();

// –≠–∫—Å–ø–æ—Ä—Ç
const image = await canvasRef.current?.export();
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤:

```typescript
// hooks/__tests__/useHistory.test.ts
describe('useHistory', () => {
  it('should undo action', () => {
    // ...
  });
});

// services/__tests__/pathService.test.ts
describe('pathService', () => {
  it('should create valid path', () => {
    // ...
  });
});
```

## üîÆ –ë—É–¥—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ì–æ—Ç–æ–≤–æ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é:
- [ ] –°–ª–æ–∏ (layers)
- [ ] –§–∏–≥—É—Ä—ã (shapes: circle, rectangle, star)
- [ ] –¢–µ–∫—Å—Ç
- [ ] –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (zoom, pan, rotate)
- [ ] –§–∏–ª—å—Ç—Ä—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
- [ ] –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã
- [ ] –ü–∞—Ç—Ç–µ—Ä–Ω—ã
- [ ] –°—Ç–∏–∫–µ—Ä—ã/—à—Ç–∞–º–ø—ã
- [ ] –°–∏–º–º–µ—Ç—Ä–∏—è (mirror mode)
- [ ] –°–µ—Ç–∫–∞/–Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ
- [ ] –ò–º–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ú—É–ª—å—Ç–∏—Ç–∞—á –∂–µ—Å—Ç—ã
- [ ] Pressure sensitivity
- [ ] –ó–∞–ø–∏—Å—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
- [ ] Collaborative drawing (multiplayer)

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### DrawingCanvasProps
| Prop | Type | Required | Description |
|------|------|----------|-------------|
| visible | boolean | ‚úÖ | –í–∏–¥–∏–º–æ—Å—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ |
| onClose | () => void | ‚úÖ | Callback –∑–∞–∫—Ä—ã—Ç–∏—è |
| onSave | (imagePath: string) => void | ‚ùå | Callback —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è |

### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ —Ç–∏–ø—ã
- `DrawingCanvasProps`
- `PathData`
- `ToolType`
- `CanvasState`
- `ToolConfig`
- `ColorConfig`
- `BrushSizeConfig`

### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `COLORS` - –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
- `BRUSH_SIZES` - —Ä–∞–∑–º–µ—Ä—ã –∫–∏—Å—Ç–∏
- `TOOLS` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `DEFAULT_COLOR`, `DEFAULT_STROKE_WIDTH`, `DEFAULT_TOOL`

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
1. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ö—É–∫/—Å–µ—Ä–≤–∏—Å
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø—ã –≤ `types/`
3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ README
5. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã

## üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
```typescript
/**
 * Creates a new Skia path starting at given coordinates
 */
createPath: (x: number, y: number): SkPath => {
  // ...
}
```

---

**–ê–≤—Ç–æ—Ä**: StoryCanvas Team  
**–í–µ—Ä—Å–∏—è**: 2.0 (Modular Architecture)  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: November 2025

